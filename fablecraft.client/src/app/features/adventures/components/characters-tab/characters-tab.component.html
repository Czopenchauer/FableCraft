<!-- Loading State -->
<div *ngIf="isLoading" class="loading-state">
  <svg class="spinner" fill="none" viewBox="0 0 24 24">
    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
    <path
      class="opacity-75"
      d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
      fill="currentColor"></path>
  </svg>
  <p>Loading characters...</p>
</div>

<!-- Main Content - Two Column Layout -->
<div *ngIf="!isLoading" class="characters-body">
  <!-- Left Column: Character List Sidebar -->
  <div class="character-sidebar">
    <!-- Main Character Graph Button -->
    <button
      (click)="openMainCharacterGraph()"
      class="main-character-graph-btn"
      title="View Main Character Knowledge Graph"
    >
      <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
        <path
          d="M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0020.25 18V6A2.25 2.25 0 0018 3.75H6A2.25 2.25 0 003.75 6v12A2.25 2.25 0 006 20.25z"
          stroke-linecap="round"
          stroke-linejoin="round"/>
      </svg>
      <span>Main Character Graph</span>
    </button>

    <!-- Empty state when no characters -->
    <div *ngIf="characters.length === 0" class="empty-state">
      <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"
          stroke-linecap="round" stroke-linejoin="round"
          stroke-width="1.5"/>
      </svg>
      <p>No characters found for this adventure.</p>
    </div>

    <!-- Character list -->
    <div class="character-list">
      <div
        (click)="selectCharacter(char.characterId)"
        *ngFor="let char of characters"
        [class.selected]="selectedCharacterId === char.characterId"
        class="character-list-item"
      >
        <span class="character-name">{{ char.name }}</span>
        <span [ngClass]="getImportanceBadgeClass(char)" class="importance-badge">
          {{ getImportanceLabel(char.importance) }}
        </span>
        <button
          (click)="openCharacterGraph(char.characterId); $event.stopPropagation()"
          class="character-graph-btn"
          title="View {{ char.name }}'s Knowledge Graph"
        >
          <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <path
              d="M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0020.25 18V6A2.25 2.25 0 0018 3.75H6A2.25 2.25 0 003.75 6v12A2.25 2.25 0 006 20.25z"
              stroke-linecap="round"
              stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Right Column: Character Detail -->
  <div class="character-detail-pane">
    <!-- Loading state for detail -->
    <div *ngIf="isLoadingDetail" class="loading-detail">
      <svg class="spinner" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path
          class="opacity-75"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          fill="currentColor"></path>
      </svg>
    </div>

    <!-- Character detail component -->
    <app-character-detail
      (characterUpdated)="onCharacterUpdated()"
      *ngIf="selectedCharacter && !isLoadingDetail"
      [adventureId]="adventureId"
      [canEditImportance]="canEditImportance(selectedCharacter)"
      [character]="selectedCharacter">
    </app-character-detail>

    <!-- Empty state when no character selected -->
    <div *ngIf="!selectedCharacter && !isLoadingDetail && characters.length > 0" class="no-selection">
      <svg class="no-selection-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"
          stroke-linecap="round" stroke-linejoin="round"
          stroke-width="1.5"/>
      </svg>
      <p>Select a character to view details</p>
    </div>
  </div>
</div>
